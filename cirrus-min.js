var cirrus={version:"0.1.1"};if(cirrus.init=function(t){var e={container:".container",width:"auto",height:"auto",margin:{top:20,right:20,bottom:50,left:50},type:"bar",subtype:"stacked",labelFormatterX:function(t){return t},tooltipFormatter:function(t){return t.value},axisXAngle:null,tickSize:15,minorTickSize:10,fringeSize:8,tickYCount:5,axisXTickSkip:"auto",continuousXAxis:!1,gutterPercent:10,renderer:"svg",scaleType:"time",keyX:"x",keyY:"y",outerPadding:0,showFringe:!1,showAxes:!0,showXGrid:!1,showYGrid:!1,showLegend:!1,autoTypeThreshold:30,chartTitle:null,axisXTitle:null,axisYTitle:null,colorList:cirrus.utils.defaultColors},r={width:null,height:null,chartWidth:500,chartHeight:500,data:null,visibleData:null,shapeLayout:null,scaleX:null,scaleY:null,axesLayout:{},legendLayout:{},fringeLayout:{},previousData:null,container:null,dataLayersToHide:[],outerPadding:null,gutterPercent:10,events:d3.dispatch("hover","hoverOut","legendClick"),internalEvents:d3.dispatch("setHover","hideHover","resize","legendClick")},i={};return i.initialize=cirrus.utils.once(function(e,r){this.setConfig(t),r.container=d3.select(e.container),r.container.html(cirrus.template.main),r.internalEvents.on("legendClick",function(t){r.dataLayersToHide=t,that.render()})}),i.setConfig=function(t){return cirrus.utils.override(t,e),this},i.getConfig=function(){return e},i._getConfig=function(){return r},i.resize=function(){return this.render(),this},i.downloadAsPNG=function(t){return cirrus.utils.convertToImage(e,r,t),this},i.setHovering=function(t){return r.internalEvents.setHover(t),this},i.hideHovering=function(){return r.internalEvents.hideHover(),this},i.render=function(t){return cirrus.data.validate(e,r,t)?(this.initialize.call(this,e,r),cirrus.automatic.config.call(this,e,r),r.scaleX=cirrus.scale.x(e,r),r.scaleY=cirrus.scale.y(e,r),r.scaleColor=cirrus.scale.color(e,r),r.shapeLayout=cirrus.layout.shape(e,r),r.axesLayout.x=cirrus.layout.axes.x(e,r),r.axesLayout.y=cirrus.layout.axes.y(e,r),r.legendLayout=cirrus.layout.legend(e,r),cirrus.component.chart(e,r),cirrus.component.shapes(e,r),cirrus.component.axisX(e,r),cirrus.component.axisY(e,r),cirrus.component.title(e,r),cirrus.component.legend(e,r),cirrus.interaction.hovering(e,r),this):(console.error("Invalid data",t),this)},d3.rebind(i,r.events,"on"),i},cirrus.utils={},cirrus.utils.override=function(t,e){for(var r in t)r in e&&(e[r]=t[r])},cirrus.utils.computeRandomNumericArray=function(t,e,r){return d3.range(t||0).map(function(){return~~(Math.random()*(r-e)+e)})},cirrus.utils.computeRandomTimeArray=function(t,e){var r=864e5,e=(new Date).getTime()-t*r;return d3.range(t||0).map(function(t,i){return e+i*r})},cirrus.utils.getRandomNumericData=function(t,e){var r=d3.range(t);return d3.range(e).map(function(e,i){var n=cirrus.utils.computeRandomNumericArray(t,10,100),a=d3.zip(r,n).map(function(t){return{x:t[0],y:t[1]}});return{name:"name"+i,values:a}})},cirrus.utils.defaultColors=["skyblue","orange","lime","orangered","violet","yellow","brown","pink"],cirrus.utils.getRandomTimeData=function(t,e){var r=(new Date).getTime(),i=cirrus.utils.computeRandomTimeArray(t,r);return d3.range(e).map(function(e,r){var n=cirrus.utils.computeRandomNumericArray(t,10,100),a=d3.zip(i,n).map(function(t){return{x:t[0],y:t[1]}});return{name:"name"+r,values:a}})},cirrus.utils.getRandomHeatmapData=function(t,e){var r=(new Date).getTime(),i=cirrus.utils.computeRandomTimeArray(t,r);return d3.range(e).map(function(e,r){var n=cirrus.utils.computeRandomNumericArray(t,10,100),a=d3.zip(i,n).map(function(t){return{x:t[0],y:1,color:t[1]}});return{name:"name"+r,values:a}})},cirrus.utils.throttle=function(t,e){var r=!1,i=null;return function(){r||(t.apply(this,arguments),r=!0,clearTimeout(i),i=setTimeout(function(){r=!1,t.apply(this,arguments)},e))}},cirrus.utils.convertToImage=function(t,e,r){var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1}),n=e.container.node(),a=(new XMLSerializer).serializeToString(n),o={width:n.offsetWidth,height:n.offsetHeight,rootFontSize:14},s='<svg xmlns="http://www.w3.org/2000/svg" width="'+o.width+'" height="'+o.height+'" font-size="'+o.rootFontSize+'"><foreignObject>'+a+"</foreignObject></svg>",c=document.createElement("canvas");c.width=o.width,c.height=o.height;var u=c.getContext("2d"),l=new Image;l.onload=function(){u.drawImage(l,0,0);var t=c.toDataURL("image/png");if(r)r.call(this,t);else{var e='<a href="'+t+'" download="converted-image">Download</a>',n=document.createElement("div");n.id="#png-container",n.innerHTML=e,n.querySelector("a").dispatchEvent(i)}},l.src="data:image/svg+xml;base64,"+btoa(s)},cirrus.utils.extractValues=function(t,e){return t.map(function(t){return t.values.map(function(t){return t[e]})})},cirrus.utils.once=function(t,e){var r;return function(){return t&&(r=t.apply(e||this,arguments),t=null),r}},cirrus.data={},cirrus.data.validate=function(t,e,r){var i=!1;if(r&&"object"==typeof r){var n=!1;if(r.forEach(function(t){n=n||!!t.values.length}),n){var a=JSON.parse(JSON.stringify(r));e.previousData=a,e.data=a,i=!0}}return e.previousData&&(e.data=e.previousData,i=!0),e.visibleData=e.data.filter(function(t){return-1===e.dataLayersToHide.indexOf(t.name)}),i},cirrus.automatic={},cirrus.automatic.config=function(t,e){if("auto"===t.type){var r=e.data[0].values.length;this.setConfig(r<t.autoTypeThreshold?{type:"bar",continuousXAxis:!1,outerPadding:"auto"}:{type:"line",continuousXAxis:!0})}if("auto"!==t.width&&t.width||(e.width=e.container.node().offsetWidth),e.chartWidth=e.width-t.margin.left-t.margin.right,"auto"!==t.height&&t.height||(e.height=e.container.node().offsetHeight),e.chartHeight=e.height-t.margin.top-t.margin.bottom,"auto"===t.outerPadding||"bar"===t.type){var i=cirrus.utils.extractValues(e.data,t.keyX);e.outerPadding=e.chartWidth/i[0].length/2}return"line"===t.type&&(e.outerPadding=0),"grid"===t.subtype&&(e.gutterPercent=0),e.data.forEach(function(e,r){d3.keys(e.values[0]).indexOf("color")>-1?e.color=null:e.color||(e.color=t.colorList[r%t.colorList.length])}),this},cirrus.template={},cirrus.template.main='<div class="chart"><div class="title"></div><div class="axis-title-y"></div><div class="grid-x"></div><div class="grid-y"></div><div class="panel"><div class="shape"></div><div class="hovering"></div></div><div class="axis-x"></div><div class="axis-y"></div><div class="axis-title-x"></div><div class="legend"></div></div>',cirrus.layout={data:{},axes:{},fringes:{}},cirrus.layout.shape=function(t,e){e.visibleData=e.data.filter(function(t){return-1===e.dataLayersToHide.indexOf(t.name)});var r=e.scaleY.copy(),i=e.scaleY.copy(),n=cirrus.utils.extractValues(e.visibleData,t.keyY),a=d3.transpose(n),o=null,s=e.chartWidth;return e.visibleData[0].values.forEach(function(r,i){var n=r[t.keyX];"time"===t.scaleType?n=new Date(n):"ordinal"===t.scaleType&&(n=i);var a=e.scaleX(n)-e.scaleX(o);0!==i&&s>a&&(s=a),o=n}),s=Math.max(s,1),e.visibleData.map(function(n,o){var c=null;return n.values.map(function(u,l){r.domain([0,d3.sum(a[l])]),i.domain([0,d3.max(a.map(function(t){return d3.sum(t)}))]);var d=u[t.keyX];"time"===t.scaleType?d=new Date(d):"ordinal"===t.scaleType&&(d=l);var p=u[t.keyY],h=s/100*e.gutterPercent,f={key:u[t.keyX],value:p,normalizedValue:p/e.scaleY.domain()[1],index:l,parentData:n,x:e.scaleX(d),y:e.chartHeight-e.scaleY(p),stackedPercentY:e.chartHeight-r(d3.sum(a[l].slice(0,o+1))),stackedY:e.chartHeight-i(d3.sum(a[l].slice(0,o+1))),w:s,h:e.scaleY(p),gutterW:h,stackedPercentH:r(p),stackedH:i(p),layerCount:e.visibleData.length,layerIndex:o,centerX:e.scaleX(d)+s/2,color:n.color||e.scaleColor(u.color)};return f.previous=c||f,c=f,f})})},cirrus.layout.axes.x=function(t,e){var r=e.scaleX.copy();return t.continuousXAxis?r.ticks().map(function(t){return{key:t,x:r(t)}}):e.visibleData[0].values.map(function(e,i){var n=e[t.keyX];return"time"===t.scaleType?n=new Date(n):"ordinal"===t.scaleType&&(n=i),{key:e[t.keyX],x:r(n)}})},cirrus.layout.axes.y=function(t,e){var r=e.scaleY.copy(),i=e.scaleY.copy(),n=e.scaleY.copy(),a=cirrus.utils.extractValues(e.visibleData,t.keyY),o=d3.transpose(a),s=d3.max(d3.merge(a));r.domain([s,0]);var c=d3.max(o.map(function(t){return d3.sum(t)}));n.domain([c,0]);var u=d3.max(o.map(function(t){return d3.sum(t)}));return i.domain([u,0]),d3.range(t.tickYCount).map(function(e,i){var n=i*s/(t.tickYCount-1);return{label:n,stackedLabel:i*c/(t.tickYCount-1),labelY:r(n)}})},cirrus.layout.legend=function(t,e){return e.data.map(function(t){return{name:t.name,color:t.color}})},cirrus.layout.fringes.y=function(){},cirrus.attribute={bar:{},line:{},point:{},axis:{}},cirrus.attribute.bar.simple=function(t,e){return e.shapeLayout.map(function(t){return t.map(function(e){return{x:e.x-e.w/2+e.gutterW/2,y:e.y,width:e.w-e.gutterW,height:e.h,color:t[0].color}})})},cirrus.attribute.bar.percent=function(t,e){return e.shapeLayout.map(function(t){return t.map(function(e){return{x:e.x-e.w/2+e.gutterW/2,y:e.stackedPercentY,width:e.w-e.gutterW,height:e.stackedPercentH,color:t[0].color}})})},cirrus.attribute.bar.grid=function(t,e){return e.shapeLayout.map(function(t){return t.map(function(t){return{x:t.x-t.w/2+t.gutterW/2,y:t.stackedPercentY,width:t.w-t.gutterW,height:t.stackedPercentH,color:t.color}})})},cirrus.attribute.bar.stacked=function(t,e){return e.shapeLayout.map(function(t){return t.map(function(e){return{x:e.x-e.w/2+e.gutterW/2,y:e.stackedY,width:e.w-e.gutterW,height:e.stackedH,color:t[0].color}})})},cirrus.attribute.line.simple=function(t,e){return e.shapeLayout.map(function(t){return{points:t.map(function(t){return[t.x,t.y]}),color:t[0].color}})},cirrus.attribute.line.stacked=function(t,e){return e.shapeLayout.map(function(t){return{points:t.map(function(t){return[t.x,t.stackedY]}),color:t[0].color}})},cirrus.attribute.line.area=function(t,e){return e.shapeLayout.map(function(t,r){var i=t.map(function(t){return[t.x,t.stackedY]}),n=null;n=0===r?t.map(function(t){return[t.x,e.chartHeight]}).reverse():e.shapeLayout[r-1].map(function(t){return[t.x,t.stackedY]}).reverse();var a=i.concat(n);return{points:a,color:t[0].color}})},cirrus.attribute.axis.labelX=function(t){var e={};return e=t.axisXAngle<0?{left:function(t){return t.x-this.offsetWidth+"px"},"transform-origin":"100%",transform:"rotate("+t.axisXAngle+"deg)"}:t.axisXAngle>0?{left:function(t){return t.x+"px"},"transform-origin":"0%",transform:"rotate("+t.axisXAngle+"deg)"}:{left:function(t){return t.x-this.offsetWidth/2+"px"}},e.display=function(e,r){return r%t.axisXTickSkip?"none":"block"},e.top=t.tickSize+"px",e},cirrus.attribute.axis.tickX=function(t){var e=1;return{left:function(t){return t.x-e/2+"px"},width:e+"px",height:function(e,r){return(r%t.axisXTickSkip?t.minorTickSize:t.tickSize)+"px"}}},cirrus.attribute.axis.gridX=function(t,e){var r=1;return{top:t.margin.top+"px",left:function(e){return t.margin.left+e.x-r/2-this.offsetWidth+"px"},width:r+"px",height:function(r,i){return(i%t.axisXTickSkip?0:e.chartHeight)+"px"}}},cirrus.attribute.axis.fringeX=function(t){var e=d3.scale.linear().domain([0,1]).range(["yellow","limegreen"]);return{left:function(t){return t.x-t.w/2+t.gutterW/2+"px"},width:function(t){return Math.max(t.w-t.gutterW,1)+"px"},height:function(){return t.fringeSize+"px"},"background-color":function(t){return e(t.normalizedValue)}}},cirrus.attribute.axis.labelY=function(t){return{position:"absolute",left:function(){var e=this.offsetWidth;return t.margin.left-e-t.tickSize+"px"},top:function(t){var e=this.offsetHeight;return t.labelY-e/2+"px"}}},cirrus.attribute.axis.tickY=function(t){var e=1;return{width:t.tickSize+"px",height:e+"px",position:"absolute",left:t.margin.left-t.tickSize+"px",top:function(t){return t.labelY+"px"}}},cirrus.attribute.axis.gridY=function(t,e){var r=1;return{width:e.chartWidth+"px",height:r+"px",position:"absolute",left:t.margin.left+"px",top:function(e){return t.margin.top+e.labelY+"px"}}},cirrus.attribute.axis.fringeY=function(t){var e=d3.scale.linear().domain([0,1]).range(["yellow","limegreen"]),r=3;return{position:"absolute",left:t.margin.left-t.fringeSize+"px",top:function(t){return t.y-r/2+"px"},width:function(){return t.fringeSize+"px"},height:function(){return r+"px"},"background-color":function(t){return e(t.normalizedValue)}}},cirrus.interaction={},cirrus.interaction.hovering=function(t,e){var r=e.container.select(".hovering");if(r.on("mousemove"))return this;r.style({width:e.chartWidth+"px",height:e.chartHeight+"px",position:"absolute",opacity:0}).on("mousemove",function(){var t=d3.mouse(this),r=e.shapeLayout[0].map(function(t){return t.x}),i=e.shapeLayout[0][0].w/2,n=d3.bisect(r,t[0]-i);n=Math.min(n,r.length-1),a(n),e.events.hover({mouse:t,x:r,idx:n})}).on("mouseenter",function(){r.style({opacity:1})}).on("mouseout",function(){r.style({opacity:0}),e.events.hoverOut()});var i=cirrus.interaction.hoverLine(t,e),n=cirrus.interaction.tooltip(t,e);e.internalEvents.on("setHover",function(t){a(t.idx)}),e.internalEvents.on("hideHover",function(){r.style({opacity:0})});var a=function(t){var a=e.shapeLayout[0][t],o=e.shapeLayout.map(function(e){return e[t]});r.style({opacity:1}),i(a),n(o)}},cirrus.interaction.tooltip=function(t,e){return function(r){var i=e.container.select(".hovering"),n=i.selectAll(".tooltip").data(r);n.enter().append("div").attr({"class":"tooltip"}).style({position:"absolute","pointer-events":"none","z-index":2}),n.html(function(e){return t.tooltipFormatter(e)}).style({left:function(t){return t.x+"px"},top:function(e){var r=e.stackedY;return"simple"===t.subtype?r=e.y:"percent"===t.subtype&&(r=e.stackedPercentY),r+"px"},"background-color":function(t){return t.color}}),n.exit().remove()}},cirrus.interaction.hoverLine=function(t,e){var r=e.container.select(".hovering").append("div").attr({"class":"hover-line"}).style({position:"absolute",width:"1px",height:e.chartHeight+"px",left:t.margin.left+"px","pointer-events":"none"});return function(t){r.style({left:t.x+"px"})}},cirrus.scale={},cirrus.scale.x=function(t,e){var r=cirrus.utils.extractValues(e.visibleData,t.keyX),i=d3.merge(r),n=[e.outerPadding,e.chartWidth-e.outerPadding],a=null;return"time"===t.scaleType?(a=d3.time.scale().range(n),i=i.map(function(t){return new Date(t)}),a.domain(d3.extent(i))):"ordinal"===t.scaleType?(a=d3.scale.linear().range(n),a.domain([0,r[0].length-1])):(a=d3.scale.linear().range(n),a.domain(d3.extent(i))),a},cirrus.scale.y=function(t,e){var r=d3.merge(cirrus.utils.extractValues(e.visibleData,t.keyY));return d3.scale.linear().range([0,e.chartHeight]).domain([0,d3.max(r)])},cirrus.scale.color=function(t,e){var r=d3.merge(cirrus.utils.extractValues(e.visibleData,"color"));return d3.scale.linear().range(["yellow","red"]).domain([0,d3.max(r)])},cirrus.renderer={svg:null,canvas:null},cirrus.renderer.svg=function(t){var e={},r=d3.select(t).append("svg").attr({width:t.offsetWidth,height:t.offsetHeight}).style({position:"absolute"});return e.polygon=function(t){return r.append("path").attr({d:"M"+t.points.join("L"),fill:t.fill||"silver",stroke:t.stroke||"silver"}),this},e.rect=function(t){return path=r.append("rect").attr(t.rect).attr({fill:t.fill||"silver",stroke:t.stroke||"silver"}),this},e},cirrus.renderer.canvas=function(t){var e={},r=d3.select(t).append("canvas").attr({width:t.offsetWidth,height:t.offsetHeight}).style({position:"absolute"}),i=r.node().getContext("2d");return e.polygon=function(t){var e=t.fill;return"none"!==t.fill&&t.fill||(e="transparent"),i.fillStyle=e,i.strokeStyle=t.stroke,i.beginPath(),t.points.forEach(function(t,e){0===e?i.moveTo(t[0],t[1]):i.lineTo(t[0],t[1])}),i.fill(),i.stroke(),this},e.rect=function(t){return i.fillStyle=t.fill,i.strokeStyle=t.stroke,i.fillRect(t.rect.x,t.rect.y,t.rect.width,t.rect.height),this},e.circle=function(t){return i.fillStyle=t.fill,i.strokeStyle=t.stroke,context.beginPath(),context.arc(t.circle.x,t.circle.y,t.circle.r,0,2*Math.PI,!1),context.fill(),context.stroke(),this},e},cirrus.component={},cirrus.component.chart=function(t,e){{var r=e.container.select(".chart").style({position:"absolute",width:e.width+"px",height:e.height+"px"});r.select(".panel").style({position:"absolute",left:t.margin.left+"px",top:t.margin.top+"px",width:e.chartWidth+"px",height:e.chartHeight+"px"}),r.select(".shape").style({position:"absolute",width:e.chartWidth+"px",height:e.chartHeight+"px"})}},cirrus.component.shapes=function(t,e){var r=cirrus.attribute[t.type][t.subtype](t,e),i=e.container.select(".shape");i.html("");var n=cirrus.renderer[t.renderer](i.node());return r.forEach("line"===t.type?function(e){var r=null;r="area"===t.subtype?e.color:"none",n.polygon({points:e.points,fill:r,stroke:e.color})}:function(t){t.forEach(function(t){n.rect({rect:t,fill:t.color,stroke:t.color})})}),this},cirrus.component.title=function(t,e){t.chartTitle&&e.container.select(".title").html(t.chartTitle).style({width:"100%","text-align":"center"}),t.axisXTitle&&e.container.select(".axis-title-x").html(t.axisXTitle).style({top:function(){return e.height-this.offsetHeight+"px"},position:"absolute",width:"100%","text-align":"center"}),t.axisYTitle&&e.container.select(".axis-title-y").html(t.axisYTitle).style({transform:"rotate(-90deg) translate(-"+e.height/2+"px)","transform-origin":"0 0"})},cirrus.component.axisX=function(t,e){if(t.showAxes){var r=e.container.select(".axis-x").style({width:e.chartWidth+"px",height:t.margin.bottom+"px",position:"absolute",top:e.chartHeight+t.margin.top+"px",left:t.margin.left+"px","border-top":"1px solid black"});if(t.showFringe){var i=r.selectAll("div.fringe-x").data(e.shapeLayout[0]);i.enter().append("div").classed("fringe-x",!0).style({position:"absolute"}),i.style(cirrus.attribute.axis.fringeX(t,e)),i.exit().remove()}var n=r.selectAll("div.label").data(e.axesLayout.x);n.enter().append("div").classed("label",!0).style({position:"absolute"}),n.html(function(e,r){return t.labelFormatterX(e.key,r)}).style(cirrus.attribute.axis.labelX(t,e)),n.style(cirrus.attribute.axis.labelX(t,e)),n.exit().remove();var a=[];if("auto"===t.axisXTickSkip){var o=null;n[0].forEach(function(t,e){var r=!1;return o&&(r=parseFloat(t.style.left)-parseFloat(o.style.left)<t.offsetWidth),r?a.push(e):o=t,d3.select(t).style({opacity:+!r}),t.offsetWidth})}if(t.showXGrid){var s=e.container.select(".grid-x").selectAll("div.grid-line-x").data(e.axesLayout.x);s.enter().append("div").classed("grid-line-x",!0).style({position:"absolute"}).style({"background-color":"#eee"}),s.style(cirrus.attribute.axis.gridX(t,e)),"auto"===t.axisXTickSkip&&s.style({height:function(t,e){var r=-1!==a.indexOf(e);return(r?0:t.height)+"px"}}),s.exit().remove()}var c=r.selectAll("div.tick").data(e.axesLayout.x);c.enter().append("div").classed("tick",!0).style({position:"absolute"}).style({"background-color":"black"}),c.style(cirrus.attribute.axis.tickX(t,e)),"auto"===t.axisXTickSkip&&c.style({height:function(e,r){var i=-1!==a.indexOf(r);return(i?t.minorTickSize:t.tickSize)+"px"}}),c.exit().remove()}},cirrus.component.axisY=function(t,e){if(t.showAxes){var r=e.container.select(".axis-y").style({width:t.margin.left+"px",height:e.chartHeight+"px",position:"absolute",top:t.margin.top+"px",left:"0px","border-right":"1px solid black"});if(t.showFringe){var i=r.selectAll("div.fringe-y").data(e.shapeLayout[0]);i.enter().append("div").classed("fringe-y",!0).style({position:"absolute"}),i.style(cirrus.attribute.axis.fringeY(t,e)),i.exit().remove()}if(t.showYGrid){var n=e.container.select(".grid-y").selectAll("div.grid-line-y").data(e.axesLayout.y);n.enter().append("div").classed("grid-line-y",!0).style({position:"absolute"}).style({"background-color":"#eee"}),n.style(cirrus.attribute.axis.gridY(t,e)),n.exit().remove()}var a=r.selectAll("div.label").data(e.axesLayout.y);a.enter().append("div").classed("label",!0),a.html(function(e){return"simple"===t.subtype?e.label:e.stackedLabel}).style(cirrus.attribute.axis.labelY(t,e)),a.exit().remove();var o=r.selectAll("div.tick").data(e.axesLayout.y);o.enter().append("div").classed("tick",!0).style({"background-color":"black"}),o.style(cirrus.attribute.axis.tickY(t,e)),o.exit().remove()}},cirrus.component.legend=function(t,e){if(!t.showLegend)return this;var r=e.container.select(".legend").style({position:"absolute"}),i=r.selectAll("p.legend-item").data(e.legendLayout);i.enter().append("p").classed("legend-item",!0).each(function(t){var r=this,n=d3.select(this).append("a").style({cursor:"pointer"}).on("click",function(){var t=d3.select(r);d3.select(r).classed("unchecked",!t.classed("unchecked"));var n=[];i.each(function(t){this.classList.contains("unchecked")&&n.push(t.name)}),e.events.legendClick(n),e.internalEvents.legendClick(n)});n.append("span").attr({"class":"legend-color"}).style({display:"inline-block",width:"10px",height:"10px","border-radius":"5px","background-color":function(t){return t.color}}),n.append("span").attr({"class":"legend-name"}).style({display:"inline-block"}).html(function(){return t.name})}),i.exit().remove(),r.style({left:function(){return e.width-this.offsetWidth+"px"}})},"function"==typeof define&&define.amd)define(cirrus);else if("object"==typeof module&&module.exports){var d3=require("d3");module.exports=cirrus}