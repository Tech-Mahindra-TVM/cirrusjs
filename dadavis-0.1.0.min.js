var dadavis={version:"0.1.0"};dadavis.init=function(t){var e={containerSelector:".container",width:500,height:500,margin:{top:20,right:20,bottom:50,left:50},type:"bar",subtype:"stacked",labelFormatterX:null,axisXAngle:null,tickSize:10,tickYCount:5,axisXTickSkip:null,dotSize:2},a={chartWidth:500,chartHeight:500,data:null,layout:null,scaleX:null,scaleY:null,previousData:null,container:null,noPadding:!1};return dadavis.utils.override(t,e),a.container=d3.select(e.containerSelector),a.container.html(dadavis.template.main),exports={},exports.setConfig=function(t){return dadavis.utils.override(t,e),this},exports.render=function(t){return t?(a.previousData=t,a.data=t):a.data=a.previousData,this.setConfig({width:a.container.node().offsetWidth,height:a.container.node().offsetHeight}),a.chartWidth=e.width-e.margin.left-e.margin.right,a.chartHeight=e.height-e.margin.top-e.margin.bottom,"line"===e.type&&(a.noPadding=!0),a.scaleX=d3.scale.linear().range([0,a.chartWidth]),a.scaleY=d3.scale.linear().range([0,a.chartHeight]),a.layout=dadavis.getLayout.data.call(this,e,a),a.axesLayout=dadavis.getLayout.axes.call(this,e,a),dadavis.render.chart(e,a),this},exports},dadavis.utils={},dadavis.utils.override=function(t,e){for(var a in t)a in e&&(e[a]=t[a])},dadavis.utils.computeRandomNumericArray=function(t,e,a){return d3.range(t||0).map(function(){return~~(Math.random()*(a-e)+e)})},dadavis.utils.computeRandomTimeArray=function(t,e,a){return d3.range(t||0).map(function(){return~~(Math.random()*(a-e)+e)})},dadavis.utils.getRandomNumericData=function(t,e){var a=~~(Math.random()*(t||10))+2,i=~~(Math.random()*(e||5))+2;return d3.range(i).map(function(t,e){return{name:"name"+e,values:dadavis.utils.computeRandomNumericArray(a,10,100)}})},dadavis.utils.getRandomTimeData=function(t,e){var a=~~(Math.random()*(t||10))+2,i=~~(Math.random()*(e||5))+2;return d3.range(i).map(function(t,e){return{name:"name"+e,values:dadavis.utils.computeRandomTimeArray(a,10,100)}})},dadavis.template={},dadavis.template.main='<svg class="chart"><g class="panel"></g></svg><div class="axis-x"></div><div class="axis-y"></div>',dadavis.getLayout={data:{},axes:{}},dadavis.getLayout.data=function(t,e){var a=e.scaleY.copy(),i=e.scaleY.copy(),n=e.scaleX.copy();return e.data.map(function(t,d){var r=t.values;n.domain([0,r.length]),e.scaleX.domain([0,r.length-1]),e.scaleY.domain([0,d3.max(r)]);var s=d3.transpose(e.data.map(function(t){return t.values})),o=null;return r.map(function(r,c){a.domain([0,d3.sum(s[c])]),i.domain([0,d3.max(s.map(function(t){return d3.sum(t)}))]);var l={value:r,index:c,parentData:t,paddedX:n(c),x:e.scaleX(c),y:e.chartHeight-e.scaleY(r),stackedPercentY:e.chartHeight-a(d3.sum(s[c].slice(0,d+1))),stackedY:e.chartHeight-i(d3.sum(s[c].slice(0,d+1))),paddedW:n(1),w:e.scaleX(1),h:e.scaleY(r),stackedPercentH:a(r),stackedH:i(r),layerCount:e.data.length,layerIndex:d,key:t.keys[d]};return l.previous=o||l,o=l,l})})},dadavis.getLayout.axes=function(t,e){var a=e.scaleY.copy(),i=d3.max(e.data.map(function(t){return d3.sum(t.values)}));a.domain([i,0]);var n=e.scaleY.copy(),d=d3.max(e.data.map(function(t){return d3.max(t.values)}));return n.domain([d,0]),d3.range(t.tickYCount).map(function(e,a){return{label:a*d/(t.tickYCount-1),stackedLabel:a*i/(t.tickYCount-1),labelY:n(a*d/(t.tickYCount-1))}})},dadavis.getAttr={bar:{},line:{},point:{},axis:{}},dadavis.getAttr.bar.simple=function(){return{x:function(t){return t.paddedX},y:function(t){return t.y},width:function(t){return t.paddedW},height:function(t){return t.h}}},dadavis.getAttr.bar.grouped=function(){return{x:function(t,e,a){return t.paddedX+a*(t.paddedW/t.layerCount-.04*t.w)},y:function(t){return t.y},width:function(t){return t.paddedW/t.layerCount-.04*t.paddedW},height:function(t){return t.h}}},dadavis.getAttr.bar.percent=function(){return{x:function(t){return t.paddedX},y:function(t){return t.stackedPercentY},width:function(t){return t.paddedW},height:function(t){return t.stackedPercentH}}},dadavis.getAttr.bar.stacked=function(){return{x:function(t){return t.paddedX},y:function(t){return t.stackedY},width:function(t){return t.paddedW},height:function(t){return t.stackedH}}},dadavis.getAttr.point.stacked=function(t,e){return{cx:function(t){return e.noPadding?t.x:t.paddedX+t.paddedW/2},cy:function(t){return t.stackedY}}},dadavis.getAttr.line.stacked=function(t,e){return{d:function(t){return e.noPadding?"M"+[[t.previous.x,t.previous.stackedY],[t.x,t.stackedY]].join("L"):"M"+[[t.previous.paddedX+t.paddedW/2,t.previous.stackedY],[t.paddedX+t.paddedW/2,t.stackedY]].join("L")}}},dadavis.getAttr.axis.labelX=function(t,e){var a={};return a=t.axisXAngle<0?{left:function(t){return e.noPadding?t.index*t.w-this.offsetWidth+"px":t.index*t.paddedW+t.paddedW/2-this.offsetWidth+"px"},top:t.tickSize+"px","transform-origin":"100%",transform:"rotate("+t.axisXAngle+"deg)"}:t.axisXAngle>0?{left:function(t){return e.noPadding?t.index*t.w+"px":t.index*t.paddedW+t.paddedW/2+"px"},top:t.tickSize+"px","transform-origin":"0%",transform:"rotate("+t.axisXAngle+"deg)"}:{left:function(t){return e.noPadding?t.index*t.w-this.offsetWidth/2+"px":t.index*t.paddedW+t.paddedW/2-this.offsetWidth/2+"px"},top:t.tickSize+"px"}},dadavis.getAttr.axis.tickX=function(t,e){return{left:function(t){return e.noPadding?t.index*t.w-this.offsetWidth+"px":t.index*t.paddedW+t.paddedW/2-this.offsetWidth+"px"},width:"1px",height:function(e,a){return(a%t.axisXTickSkip?t.tickSize/3:t.tickSize)+"px"}}},dadavis.getAttr.axis.labelY=function(){return{position:"absolute",left:"0px",top:function(t){var e=10;return t.labelY-e/2+"px"}}},dadavis.getAttr.axis.tickY=function(t){return{width:t.tickSize+"px",height:"1px",position:"absolute",left:t.margin.left-t.tickSize+"px",top:function(t){return t.labelY+"px"}}},dadavis.render={},dadavis.render.chart=function(t,e){var a=e.container.style({position:"absolute"}).select(".chart").attr({width:t.width,height:t.height}),i={transform:"translate("+[t.margin.left,t.margin.top]+")",height:t.chartHeight,width:t.chartWidth},n=a.select(".panel").attr(i),d=n.selectAll(".layer").data(e.layout);d.enter().append("g").classed("layer",!0),d.exit().remove(),d.call(function(){dadavis.render[t.type].call(this,t,e)}),e.container.select(".axis-x").call(function(){dadavis.render.axisX.call(this,t,e)}),e.container.select(".axis-y").call(function(){dadavis.render.axisY.call(this,t,e)})},dadavis.render.bar=function(t,e){var a=this.selectAll(".shape").data(function(t){return t});a.enter().append("rect").attr({"class":function(t){return"shape layer"+t.layerIndex+" index"+t.index}}).attr(dadavis.getAttr[t.type][t.subtype](t,e)).style({opacity:0}),a.transition().attr(dadavis.getAttr[t.type][t.subtype](t,e)).style({opacity:1}),a.exit().remove()},dadavis.render.line=function(t,e){var a=this.selectAll(".line").data(function(t){return t});a.enter().append("path").classed("line",!0).attr(dadavis.getAttr[t.type][t.subtype](t,e)).style({opacity:0}),a.transition().attr(dadavis.getAttr[t.type][t.subtype](t,e)).style({opacity:1}),a.exit().remove();var i=this.selectAll(".shape").data(function(t){return t});i.enter().append("circle").classed("shape",!0).attr(dadavis.getAttr.point[t.subtype](t,e)).attr({r:t.dotSize}).style({opacity:0}),i.transition().attr(dadavis.getAttr.point[t.subtype](t,e)).style({opacity:1}),i.exit().remove()},dadavis.render.axisX=function(t,e){this.style({width:e.chartWidth+"px",height:t.margin.bottom+"px",position:"absolute",top:e.chartHeight+t.margin.top+"px",left:t.margin.left+"px"});var a=this.selectAll("div.label").data(e.layout[0]);a.enter().append("div").classed("label",!0).style({position:"absolute"}),a.html(function(e,a){return t.labelFormatterX?t.labelFormatterX(e.parentData.keys[a],a):e.parentData.keys[a]}).style(dadavis.getAttr.axis.labelX(t,e)).style({display:function(e,a){return a%t.axisXTickSkip?"none":"block"}}),a.exit().remove();var i=this.selectAll("div.tick").data(e.layout[0]);i.enter().append("div").classed("tick",!0).style({position:"absolute"}),i.style(dadavis.getAttr.axis.tickX(t,e)),i.exit().remove()},dadavis.render.axisY=function(t,e){this.style({width:t.margin.left+"px",height:e.chartHeight+"px",position:"absolute",top:t.margin.top+"px",left:"0px"});var a=this.selectAll("div.label").data(e.axesLayout);a.enter().append("div").classed("label",!0),a.html(function(e){return"stacked"===t.subtype?e.stackedLabel:e.label}).style(dadavis.getAttr.axis.labelY(t,e)),a.exit().remove();var i=this.selectAll("div.tick").data(e.axesLayout);i.enter().append("div").classed("tick",!0),i.style(dadavis.getAttr.axis.tickY(t,e)),i.exit().remove()};