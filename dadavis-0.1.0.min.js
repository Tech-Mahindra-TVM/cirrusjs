var dadavis={version:"0.1.0"};if(dadavis.init=function(t){var e={containerSelector:".container",width:500,height:500,margin:{top:20,right:20,bottom:50,left:50},type:"bar",subtype:"stacked",labelFormatterX:null,axisXAngle:null,tickSize:10,minorTickSize:3,tickYCount:5,axisXTickSkip:null,dotSize:2,gutterPercent:10,colors:["skyblue","orange","lime","orangered","violet","yellow","brown","pink"]},a={chartWidth:500,chartHeight:500,data:null,layout:null,scaleX:null,scaleY:null,previousData:null,container:null,noPadding:!1};return dadavis.utils.override(t,e),a.container=d3.select(e.containerSelector),a.container.html(dadavis.template.main),exports={},exports.setConfig=function(t){return dadavis.utils.override(t,e),this},exports.render=function(t){return t?(a.previousData=t,a.data=t):a.data=a.previousData,this.setConfig({width:a.container.node().offsetWidth,height:a.container.node().offsetHeight}),a.chartWidth=e.width-e.margin.left-e.margin.right,a.chartHeight=e.height-e.margin.top-e.margin.bottom,"line"===e.type&&(a.noPadding=!0),a.scaleX=d3.scale.linear().range([0,a.chartWidth]),a.scaleY=d3.scale.linear().range([0,a.chartHeight]),a.layout=dadavis.getLayout.data.call(this,e,a),a.axesLayout=dadavis.getLayout.axes.call(this,e,a),dadavis.render.chart(e,a),dadavis.interaction.hovering(e,a),this},exports},dadavis.utils={},dadavis.utils.override=function(t,e){for(var a in t)a in e&&(e[a]=t[a])},dadavis.utils.computeRandomNumericArray=function(t,e,a){return d3.range(t||0).map(function(t,n){return~~(Math.random()*(a-e)+e)})},dadavis.utils.computeRandomTimeArray=function(t,e){var a=864e5,e=(new Date).getTime()-t*a;return d3.range(t||0).map(function(t,n){return e+n*a})},dadavis.utils.getRandomNumericData=function(t,e){return d3.range(e).map(function(e,a){return{name:"name"+a,values:dadavis.utils.computeRandomNumericArray(t,10,100)}})},dadavis.utils.getRandomTimeData=function(t,e){var a=(new Date).getTime();return d3.range(e).map(function(e,n){return{name:"name"+n,values:dadavis.utils.computeRandomNumericArray(t,10,100),keys:dadavis.utils.computeRandomTimeArray(t,a)}})},dadavis.template={},dadavis.template.main='<div class="chart"><div class="panel"><div class="hovering"></div></div><div class="axis-x"></div><div class="axis-y"></div></div>',dadavis.getLayout={data:{},axes:{}},dadavis.getLayout.data=function(t,e){var a=e.scaleY.copy(),n=e.scaleY.copy(),i=e.scaleX.copy();return e.data.map(function(t,r){var d=t.values;i.domain([0,d.length]),e.scaleX.domain([0,d.length-1]),e.scaleY.domain([0,d3.max(d)]);var o=d3.transpose(e.data.map(function(t,e){return t.values})),s=null;return d.map(function(d,c){a.domain([0,d3.sum(o[c])]),n.domain([0,d3.max(o.map(function(t,e){return d3.sum(t)}))]);var u={value:d,index:c,parentData:t,paddedX:i(c),x:e.scaleX(c),y:e.chartHeight-e.scaleY(d),stackedPercentY:e.chartHeight-a(d3.sum(o[c].slice(0,r+1))),stackedY:e.chartHeight-n(d3.sum(o[c].slice(0,r+1))),paddedW:i(1),w:e.scaleX(1),h:e.scaleY(d),stackedPercentH:a(d),stackedH:n(d),layerCount:e.data.length,layerIndex:r,key:t.keys?t.keys[r]:r};return u.previous=s||u,s=u,u})})},dadavis.getLayout.axes=function(t,e){var a=e.scaleY.copy(),n=d3.max(e.data.map(function(t,e){return d3.sum(t.values)}));a.domain([n,0]);var i=e.scaleY.copy(),r=d3.max(e.data.map(function(t,e){return d3.max(t.values)}));return i.domain([r,0]),d3.range(t.tickYCount).map(function(e,a){return{label:a*r/(t.tickYCount-1),stackedLabel:a*n/(t.tickYCount-1),labelY:i(a*r/(t.tickYCount-1))}})},dadavis.getAttr={bar:{},line:{},point:{},axis:{}},dadavis.getAttr.bar.simple=function(t,e){return{x:function(t,e){return t.paddedX+t.paddedW/2},y:function(t,e){return t.y+t.h/2},width:function(e,a){var n=e.paddedW/100*t.gutterPercent;return e.paddedW-n},height:function(t,e){return t.h}}},dadavis.getAttr.bar.grouped=function(t,e){return{x:function(e,a,n){var i=e.paddedW/e.layerCount/100*t.gutterPercent,r=e.paddedW/e.layerCount-i;return e.paddedX+n*r+r/2+e.layerCount*i/2},y:function(t,e){return t.y+t.h/2},width:function(t,e){var a=t.paddedW/t.layerCount/100*gutterPercent;return t.paddedW/t.layerCount-a},height:function(t,e){return t.h}}},dadavis.getAttr.bar.percent=function(t,e){return{x:function(t,e){return t.paddedX+t.paddedW/2},y:function(t,e){return t.stackedPercentY+t.stackedPercentH/2},width:function(e,a){var n=e.paddedW/100*t.gutterPercent;return e.paddedW-n},height:function(t,e){return t.stackedPercentH}}},dadavis.getAttr.bar.stacked=function(t,e){return{x:function(t,e){return t.paddedX+t.paddedW/2},y:function(t,e){return t.stackedY+t.stackedH/2},width:function(e,a){var n=e.paddedW/100*t.gutterPercent;return e.paddedW-n},height:function(t,e){return t.stackedH}}},dadavis.getAttr.point.stacked=function(t,e){return{cx:function(t,a){return e.noPadding?t.x:t.paddedX+t.paddedW/2},cy:function(t,e){return t.stackedY}}},dadavis.getAttr.line.simple=function(t,e){return e.layout.map(function(t,e){return d3.merge(t.map(function(t,e){return[t.x,t.y]}))})},dadavis.getAttr.line.stacked=function(t,e){return e.layout.map(function(t,e){return d3.merge(t.map(function(t,e){return[t.x,t.stackedY]}))})},dadavis.getAttr.line.area=function(t,e){return e.layout.map(function(t,a){var n=t.map(function(t,e){return[t.x,t.stackedY]}),i=null;return i=0===a?t.map(function(t,a){return[t.x,e.chartHeight]}).reverse():e.layout[a-1].map(function(t,e){return[t.x,t.stackedY]}).reverse(),d3.merge(n.concat(i))})},dadavis.getAttr.axis.labelX=function(t,e){var a={};return a=t.axisXAngle<0?{left:function(t,a){return e.noPadding?t.index*t.w-this.offsetWidth+"px":t.index*t.paddedW+t.paddedW/2-this.offsetWidth+"px"},top:t.tickSize+"px","transform-origin":"100%",transform:"rotate("+t.axisXAngle+"deg)"}:t.axisXAngle>0?{left:function(t,a){return e.noPadding?t.index*t.w+"px":t.index*t.paddedW+t.paddedW/2+"px"},top:t.tickSize+"px","transform-origin":"0%",transform:"rotate("+t.axisXAngle+"deg)"}:{left:function(t,a){return e.noPadding?t.index*t.w-this.offsetWidth/2+"px":t.index*t.paddedW+t.paddedW/2-this.offsetWidth/2+"px"},top:t.tickSize+"px"}},dadavis.getAttr.axis.tickX=function(t,e){return{left:function(t,a){return e.noPadding?t.index*t.w-this.offsetWidth+"px":t.index*t.paddedW+t.paddedW/2-this.offsetWidth+"px"},width:"1px",height:function(e,a){return(a%t.axisXTickSkip?t.minorTickSize:t.tickSize)+"px"}}},dadavis.getAttr.axis.labelY=function(t,e){return{position:"absolute",left:function(e,a){var n=this.offsetWidth;return t.margin.left-n-t.tickSize+"px"},top:function(t,e){var a=this.offsetHeight;return t.labelY-a/2+"px"}}},dadavis.getAttr.axis.tickY=function(t,e){return{width:t.tickSize+"px",height:"1px",position:"absolute",left:t.margin.left-t.tickSize+"px",top:function(t,e){return t.labelY+"px"}}},dadavis.interaction={},dadavis.interaction.hovering=function(t,e){var a=e.container.select(".hovering").style({width:e.chartWidth+"px",height:e.chartHeight+"px",position:"absolute"}).on("mousemove",function(){var t=d3.mouse(this),a=e.layout[0].map(function(t,e){return t.x}),r=d3.bisect(a,t[0]-e.layout[0][0].w/2),d=e.layout[0][r],o=e.layout.map(function(t,e){return t[r]});n(d),i(o)}).on("mouseenter",function(){a.style({opacity:1})}).on("mouseout",function(){a.style({opacity:0})}),n=dadavis.interaction.hoverLine(t,e),i=dadavis.interaction.tooltip(t,e)},dadavis.interaction.tooltip=function(t,e){return function(a){var n=e.container.select(".hovering"),i=n.selectAll(".tooltip").data(a);i.enter().append("div").attr({"class":"tooltip"}).style({position:"absolute","pointer-events":"none"}),i.html(function(t,e){return t.value}).style({left:function(e,a){return("bar"===t.type?e.paddedX+e.paddedW/2:e.x)+"px"},top:function(e,a){var n=e.stackedY;return"simple"===t.subtype?n=e.y:"percent"===t.subtype&&(n=e.stackedPercentY),n+"px"},"background-color":function(e,a){return t.colors[a]}}),i.exit().remove()}},dadavis.interaction.hoverLine=function(t,e){var a=e.container.select(".hovering").append("div").attr({"class":"hover-line"}).style({position:"absolute",width:"1px",height:e.chartHeight+"px",left:t.margin.left+"px","pointer-events":"none"});return function(e){var n="bar"===t.type?e.paddedX+e.paddedW/2:e.x;a.style({left:n+"px"})}},dadavis.render={},dadavis.render.chart=function(t,e){var a=e.container.select(".chart").style({position:"absolute"}),n=a.select(".panel").style({position:"absolute",left:t.margin.left+"px",top:t.margin.top+"px"}),i={width:t.width,height:t.height,type:Two.Types.svg},r=new Two(i).appendTo(n.node()),d=r.makeGroup(),o=dadavis.getAttr[t.type][t.subtype](t,e);console.time("rendering"),e.layout.forEach("line"===t.type?function(e,a){var n=r.makePolygon.apply(r,o[a].concat([!0]));n.fill="area"===t.subtype?t.colors[a]:"transparent",n.stroke=t.colors[a];var i=r.makeGroup(n);d.add(i)}:function(e,a){var n=r.makeGroup();e.forEach(function(i,d){var s=e[d],c=o.x(s,d,a),u=o.y(s,d,a),l=o.width(s,d,a),p=o.height(s,d,a),v=r.makeRectangle(c,u,l,p);v.fill=t.colors[a],n.add(v)}),d.add(n)}),console.timeEnd("rendering"),console.time("update"),r.update(),console.timeEnd("update"),e.container.select(".axis-x").call(function(){dadavis.render.axisX.call(this,t,e)}),e.container.select(".axis-y").call(function(){dadavis.render.axisY.call(this,t,e)})},dadavis.render.bar=function(t,e){var a=this.selectAll(".shape").data(function(t,e){return t});a.enter().append("rect").attr({"class":function(t,e){return"shape layer"+t.layerIndex+" index"+t.index}}).attr(dadavis.getAttr[t.type][t.subtype](t,e)).style({opacity:0}),a.transition().attr(dadavis.getAttr[t.type][t.subtype](t,e)).style({opacity:1}),a.exit().remove()},dadavis.render.line=function(t,e){var a=this.selectAll(".line").data(function(t,e){return t});a.enter().append("path").classed("line",!0).attr(dadavis.getAttr[t.type][t.subtype](t,e)).style({opacity:0}),a.transition().attr(dadavis.getAttr[t.type][t.subtype](t,e)).style({opacity:1}),a.exit().remove();var n=this.selectAll(".shape").data(function(t,e){return t});n.enter().append("circle").classed("shape",!0).attr(dadavis.getAttr.point[t.subtype](t,e)).attr({r:t.dotSize}).style({opacity:0}),n.transition().attr(dadavis.getAttr.point[t.subtype](t,e)).style({opacity:1}),n.exit().remove()},dadavis.render.axisX=function(t,e){this.style({width:e.chartWidth+"px",height:t.margin.bottom+"px",position:"absolute",top:e.chartHeight+t.margin.top+"px",left:t.margin.left+"px"});var a=this.selectAll("div.label").data(e.layout[0]);a.enter().append("div").classed("label",!0).style({position:"absolute"}),a.html(function(e,a){var n=e.parentData.keys?e.parentData.keys[a]:a;return t.labelFormatterX?t.labelFormatterX(n,a):n}).style(dadavis.getAttr.axis.labelX(t,e)).style({display:function(e,a){return a%t.axisXTickSkip?"none":"block"}}),a.exit().remove();var n=this.selectAll("div.tick").data(e.layout[0]);n.enter().append("div").classed("tick",!0).style({position:"absolute"}),n.style(dadavis.getAttr.axis.tickX(t,e)),n.exit().remove()},dadavis.render.axisY=function(t,e){this.style({width:t.margin.left+"px",height:e.chartHeight+"px",position:"absolute",top:t.margin.top+"px",left:"0px"});var a=this.selectAll("div.label").data(e.axesLayout);a.enter().append("div").classed("label",!0),a.html(function(e,a){return"stacked"===t.subtype?e.stackedLabel:e.label}).style(dadavis.getAttr.axis.labelY(t,e)),a.exit().remove();var n=this.selectAll("div.tick").data(e.axesLayout);n.enter().append("div").classed("tick",!0),n.style(dadavis.getAttr.axis.tickY(t,e)),n.exit().remove()},"function"==typeof define&&define.amd)define(dadavis);else if("object"==typeof module&&module.exports){var d3=require("d3");module.exports=dadavis}