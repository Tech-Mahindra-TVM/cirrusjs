var dadavis={version:"0.1.0"};dadavis.init=function(t){var e={containerSelector:".container",width:500,height:500,margin:{top:20,right:20,bottom:50,left:50},type:"bar",subtype:"stacked"},a={chartWidth:500,chartHeight:500,data:null,layout:null,scaleX:null,scaleY:null,previousData:null,container:null};return dadavis.utils.override(t,e),a.container=d3.select(e.containerSelector),a.container.html(dadavis.template.main),exports={},exports.setConfig=function(t){return dadavis.utils.override(t,e),this},exports.render=function(t){return t?(a.previousData=t,a.data=t):a.data=a.previousData,this.setConfig({width:a.container.node().offsetWidth,height:a.container.node().offsetHeight}),a.chartWidth=e.width-e.margin.left-e.margin.right,a.chartHeight=e.height-e.margin.top-e.margin.bottom,a.scaleX=d3.scale.linear().range([0,a.chartWidth]),a.scaleY=d3.scale.linear().range([0,a.chartHeight]),a.layout=dadavis.getLayout.call(this,e,a),dadavis.render.chart(e,a),this},exports},dadavis.utils={},dadavis.utils.override=function(t,e){for(var a in t)a in e&&(e[a]=t[a])},dadavis.utils.computeRandomArray=function(t,e,a){return d3.range(t||0).map(function(){return~~(Math.random()*(a-e)+e)})},dadavis.utils.getRandomData=function(t,e){var a=~~(Math.random()*(t||10))+2,n=~~(Math.random()*(e||5))+2;return d3.range(n).map(function(t,e){return{name:"name"+e,values:dadavis.utils.computeRandomArray(a,10,100)}})},dadavis.template={},dadavis.template.main='<svg class="chart"><g class="panel"></g><g class="axes"><g class="axis-x"></g><g class="axis-y"></g></g></svg>',dadavis.getLayout=function(t,e){var a=e.scaleY.copy(),n=e.scaleY.copy();return e.data.map(function(t,r){var i=t.values;e.scaleX.domain([0,i.length]),e.scaleY.domain([0,d3.max(i)]);var s=d3.transpose(e.data.map(function(t){return t.values})),d=null;return i.map(function(i,o){a.domain([0,d3.sum(s[o])]),n.domain([0,d3.max(s.map(function(t){return d3.sum(t)}))]);var c={value:i,index:o,parentData:t,x:e.scaleX(o),y:e.chartHeight-e.scaleY(i),stackedPercentY:e.chartHeight-a(d3.sum(s[o].slice(0,r+1))),stackedY:e.chartHeight-n(d3.sum(s[o].slice(0,r+1))),w:e.scaleX(1),h:e.scaleY(i),stackedPercentH:a(i),stackedH:n(i),layerCount:e.data.length,layerIndex:r};return c.previous=d||c,d=c,c})})},dadavis.getAttr={bar:{},line:{},point:{}},dadavis.getAttr.bar.simple=function(){return{x:function(t){return t.x},y:function(t){return t.y},width:function(t){return t.w},height:function(t){return t.h}}},dadavis.getAttr.bar.grouped=function(){return{x:function(t,e,a){return t.x+a*(t.w/t.layerCount-.04*t.w)},y:function(t){return t.y},width:function(t){return t.w/t.layerCount-.04*t.w},height:function(t){return t.h}}},dadavis.getAttr.bar.percent=function(){return{x:function(t){return t.x},y:function(t){return t.stackedPercentY},width:function(t){return t.w},height:function(t){return t.stackedPercentH}}},dadavis.getAttr.bar.stacked=function(){return{x:function(t){return t.x},y:function(t){return t.stackedY},width:function(t){return t.w},height:function(t){return t.stackedH}}},dadavis.getAttr.point.stacked=function(){return{cx:function(t){return t.x+t.w/2},cy:function(t){return t.stackedY}}},dadavis.getAttr.line.stacked=function(){return{d:function(t){return"M"+[[t.previous.x+t.w/2,t.previous.stackedY],[t.x+t.w/2,t.stackedY]].join("L")}}},dadavis.render={},dadavis.render.chart=function(t,e){var a=d3.select(".container .chart").attr({width:t.width,height:t.height}),n={transform:"translate("+[t.margin.left,t.margin.top]+")",height:t.chartHeight,width:t.chartWidth},r=a.select(".panel").attr(n),i=r.selectAll(".layer").data(e.layout);i.enter().append("g").classed("layer",!0),i.exit().remove(),i.call(function(){dadavis.render[t.type].call(this,t,e)}),a.select(".axes").call(function(){dadavis.render.axes.call(this,t,e)})},dadavis.render.bar=function(t){var e=this.selectAll(".shape").data(function(t){return t});e.enter().append("rect").attr({"class":function(t){return"shape layer"+t.layerIndex+" index"+t.index}}).attr(dadavis.getAttr[t.type][t.subtype]()).style({opacity:0}),e.transition().attr(dadavis.getAttr[t.type][t.subtype]()).style({opacity:1}),e.exit().remove()},dadavis.render.line=function(t){var e=2,a=this.selectAll(".line").data(function(t){return t});a.enter().append("path").classed("line",!0).attr(dadavis.getAttr[t.type][t.subtype]()).style({opacity:0}),a.transition().attr(dadavis.getAttr[t.type][t.subtype]()).style({opacity:1}),a.exit().remove();var n=this.selectAll(".shape").data(function(t){return t});n.enter().append("circle").classed("shape",!0).attr(dadavis.getAttr.point[t.subtype]()).attr({r:e}).style({opacity:0}),n.transition().attr(dadavis.getAttr.point[t.subtype]()).style({opacity:1}),n.exit().remove()},dadavis.render.axes=function(t,e){var a=10,n=5,r=e.container.style({position:"absolute"}).selectAll("div.axis-x").data([0]);r.enter().append("div").classed("axis-x",!0).style({width:e.chartWidth+"px",height:t.margin.bottom+"px",position:"absolute",top:e.chartHeight+t.margin.top+"px",left:t.margin.left+"px"});var i=r.selectAll("div.label").data(e.layout[0]);i.enter().append("div").classed("label",!0),i.html(function(t,e){return e}).style({position:"absolute",left:function(t){return t.index*t.w+t.w/2-this.offsetWidth/2+"px"},top:a+"px"}),i.exit().remove();var s=r.selectAll("div.tick").data(e.layout[0]);s.enter().append("div").classed("tick",!0),s.style({position:"absolute",left:function(t){return t.index*t.w+t.w/2+"px"},width:"1px",height:a+"px"}),s.exit().remove();var d=e.container.selectAll("div.axis-y").data([0]);d.enter().append("div").classed("axis-y",!0).style({width:t.margin.left+"px",height:e.chartHeight+"px",position:"absolute",top:t.margin.top+"px",left:"0px"}),d.exit().remove();var o=e.scaleY.copy(),c=d3.max(e.data.map(function(t){return d3.max(t.values)}));o.domain([c,0]);var l=d.selectAll("div.label").data(d3.range(n));l.enter().append("div").classed("label",!0),l.html(function(t,e){return e*c/4}).style({position:"absolute",left:"0px",top:function(t,e){return o(e*c/4)-this.offsetHeight/2+"px"}}),l.exit().remove();var u=d.selectAll("div.tick").data(d3.range(n));u.enter().append("div").classed("tick",!0),u.style({width:a+"px",height:"1px",position:"absolute",left:t.margin.left-a+"px",top:function(t,e){return o(e*c/4)+"px"}}),u.exit().remove()};